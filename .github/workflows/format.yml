# .github/workflows/format.yml
# Automatically apply formatting when pushing to main.
name: Ruff Auto-format

on:
  push:
    branches: [ "main" ] # Only runs when code is pushed to the 'main' branch

env:
  DEFAULT_PYTHON: "3.13"

jobs:
  auto_format:
    name: Ruff Auto-formatting
    runs-on: ubuntu-latest

#    permissions:
#      contents: write # Needed for stefanzweifel/git-auto-commit-action to push changes

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
#        with:
#          fetch-depth: 0 # Needed for auto-commit action to work reliably

      - name: Set up Python ${{ env.DEFAULT_PYTHON }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.DEFAULT_PYTHON }}

      - name: Run Ruff Lint Check
        # By default, astral-sh/ruff-action runs 'ruff check'.
        uses: astral-sh/ruff-action@v3
        with:
          args: "--version" # override ruff check
#        continue-on-error: true # Uncomment if you want the workflow to pass even if linting fails
        
      - run: ruff check --fix-only
      - run: ruff format
